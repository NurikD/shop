{% extends 'base.html' %}

{% block title %}Каталог - MenStyle{% endblock %}

{% block content %}
<!-- Breadcrumbs -->
<section class="bg-gray-100 py-4">
  <div class="container mx-auto px-4">
    <nav class="flex items-center space-x-2 text-sm">
      <a href="{% url 'home' %}" class="text-gray-600 hover:text-primary-600 transition-colors">Главная</a>
      <i class="fas fa-chevron-right text-gray-400 text-xs"></i>
      <span class="text-gray-800 font-medium">Каталог</span>
    </nav>
  </div>
</section>

<!-- Hero Section -->
<section class="bg-gradient-to-r from-primary-800 to-primary-900 text-white py-16">
  <div class="container mx-auto px-4 text-center">
    <h1 class="text-4xl md:text-5xl font-bold mb-4">Каталог товаров</h1>
    <p class="text-xl text-gray-300 mb-8">Откройте для себя стильную мужскую одежду высокого качества</p>
    <div class="flex justify-center items-center space-x-6 text-sm">
      <div class="flex items-center">
        <i class="fas fa-shipping-fast mr-2"></i>
        <span>Быстрая доставка</span>
      </div>
      <div class="flex items-center">
        <i class="fas fa-medal mr-2"></i>
        <span>Гарантия качества</span>
      </div>
      <div class="flex items-center">
        <i class="fas fa-undo-alt mr-2"></i>
        <span>Легкий возврат</span>
      </div>
    </div>
  </div>
</section>

<section class="py-12 bg-gray-50">
  <div class="container mx-auto px-4">
    <div class="flex flex-col lg:flex-row gap-8">
      
      <!-- Sidebar Filters -->
      <aside class="lg:w-80 space-y-6">
        <!-- Mobile Filter Toggle -->
        <div class="lg:hidden">
          <button id="filter-toggle" class="w-full bg-white border border-gray-300 rounded-lg px-4 py-3 text-left flex justify-between items-center hover:bg-gray-50 transition-colors">
            <span class="font-medium">Фильтры</span>
            <i class="fas fa-filter text-primary-600"></i>
          </button>
        </div>

        <!-- Filter Panel -->
        <div id="filter-panel" class="space-y-6 lg:block hidden">
          <!-- Search -->
          <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
            <h3 class="font-semibold text-gray-900 mb-4">
              <i class="fas fa-search mr-2 text-primary-600"></i>
              Поиск
            </h3>
            <div class="relative">
              <input type="text" 
                     placeholder="Найти товар..." 
                     class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent">
              <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            </div>
          </div>

          <!-- Categories -->
          <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
            <h3 class="font-semibold text-gray-900 mb-4">
              <i class="fas fa-tags mr-2 text-primary-600"></i>
              Категории
            </h3>
            <div class="space-y-3">
              <label class="flex items-center cursor-pointer group">
                <input type="checkbox" class="form-checkbox h-4 w-4 text-primary-600 rounded focus:ring-primary-500">
                <span class="ml-3 text-gray-700 group-hover:text-primary-600 transition-colors">Рубашки</span>
                <span class="ml-auto text-gray-400 text-sm">(24)</span>
              </label>
              <label class="flex items-center cursor-pointer group">
                <input type="checkbox" class="form-checkbox h-4 w-4 text-primary-600 rounded focus:ring-primary-500">
                <span class="ml-3 text-gray-700 group-hover:text-primary-600 transition-colors">Футболки</span>
                <span class="ml-auto text-gray-400 text-sm">(18)</span>
              </label>
              <label class="flex items-center cursor-pointer group">
                <input type="checkbox" class="form-checkbox h-4 w-4 text-primary-600 rounded focus:ring-primary-500">
                <span class="ml-3 text-gray-700 group-hover:text-primary-600 transition-colors">Джинсы</span>
                <span class="ml-auto text-gray-400 text-sm">(12)</span>
              </label>
              <label class="flex items-center cursor-pointer group">
                <input type="checkbox" class="form-checkbox h-4 w-4 text-primary-600 rounded focus:ring-primary-500">
                <span class="ml-3 text-gray-700 group-hover:text-primary-600 transition-colors">Куртки</span>
                <span class="ml-auto text-gray-400 text-sm">(8)</span>
              </label>
              <label class="flex items-center cursor-pointer group">
                <input type="checkbox" class="form-checkbox h-4 w-4 text-primary-600 rounded focus:ring-primary-500">
                <span class="ml-3 text-gray-700 group-hover:text-primary-600 transition-colors">Аксессуары</span>
                <span class="ml-auto text-gray-400 text-sm">(15)</span>
              </label>
            </div>
          </div>

          <!-- Price Range -->
          <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
            <h3 class="font-semibold text-gray-900 mb-4">
              <i class="fas fa-ruble-sign mr-2 text-primary-600"></i>
              Цена
            </h3>
            <div class="space-y-4">
                <div class="flex gap-2">
                    <input type="number" name="price_min" placeholder="От" сlass="w-1/2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500" min="0">
                    <input type="number" name="price_max" placeholder="До" class="w-1/2 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500" min="0">
                </div>
              <div class="space-y-2">
                <label class="flex items-center cursor-pointer">
                  <input type="radio" name="price_range" class="form-radio h-4 w-4 text-primary-600">
                  <span class="ml-3 text-gray-700">До 2000 ₽</span>
                </label>
                <label class="flex items-center cursor-pointer">
                  <input type="radio" name="price_range" class="form-radio h-4 w-4 text-primary-600">
                  <span class="ml-3 text-gray-700">2000 - 5000 ₽</span>
                </label>
                <label class="flex items-center cursor-pointer">
                  <input type="radio" name="price_range" class="form-radio h-4 w-4 text-primary-600">
                  <span class="ml-3 text-gray-700">5000 - 10000 ₽</span>
                </label>
                <label class="flex items-center cursor-pointer">
                  <input type="radio" name="price_range" class="form-radio h-4 w-4 text-primary-600">
                  <span class="ml-3 text-gray-700">Свыше 10000 ₽</span>
                </label>
              </div>
            </div>
          </div>

          <!-- Brands -->
          <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
            <h3 class="font-semibold text-gray-900 mb-4">
              <i class="fas fa-crown mr-2 text-primary-600"></i>
              Бренды
            </h3>
            <div class="space-y-3">
              <label class="flex items-center cursor-pointer group">
                <input type="checkbox" class="form-checkbox h-4 w-4 text-primary-600 rounded focus:ring-primary-500">
                <span class="ml-3 text-gray-700 group-hover:text-primary-600 transition-colors">Calvin Klein</span>
              </label>
              <label class="flex items-center cursor-pointer group">
                <input type="checkbox" class="form-checkbox h-4 w-4 text-primary-600 rounded focus:ring-primary-500">
                <span class="ml-3 text-gray-700 group-hover:text-primary-600 transition-colors">Tommy Hilfiger</span>
              </label>
              <label class="flex items-center cursor-pointer group">
                <input type="checkbox" class="form-checkbox h-4 w-4 text-primary-600 rounded focus:ring-primary-500">
                <span class="ml-3 text-gray-700 group-hover:text-primary-600 transition-colors">Hugo Boss</span>
              </label>
              <label class="flex items-center cursor-pointer group">
                <input type="checkbox" class="form-checkbox h-4 w-4 text-primary-600 rounded focus:ring-primary-500">
                <span class="ml-3 text-gray-700 group-hover:text-primary-600 transition-colors">Levi's</span>
              </label>
            </div>
          </div>

          <!-- Sizes -->
          <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
            <h3 class="font-semibold text-gray-900 mb-4">
              <i class="fas fa-ruler mr-2 text-primary-600"></i>
              Размеры
            </h3>
            <div class="grid grid-cols-3 gap-2">
              <button class="px-3 py-2 border border-gray-300 rounded-lg text-center hover:border-primary-500 hover:bg-primary-50 transition-colors">XS</button>
              <button class="px-3 py-2 border border-gray-300 rounded-lg text-center hover:border-primary-500 hover:bg-primary-50 transition-colors">S</button>
              <button class="px-3 py-2 border border-gray-300 rounded-lg text-center hover:border-primary-500 hover:bg-primary-50 transition-colors">M</button>
              <button class="px-3 py-2 border border-gray-300 rounded-lg text-center hover:border-primary-500 hover:bg-primary-50 transition-colors">L</button>
              <button class="px-3 py-2 border border-gray-300 rounded-lg text-center hover:border-primary-500 hover:bg-primary-50 transition-colors">XL</button>
              <button class="px-3 py-2 border border-gray-300 rounded-lg text-center hover:border-primary-500 hover:bg-primary-50 transition-colors">XXL</button>
            </div>
          </div>

          <!-- Clear Filters -->
          <button class="w-full bg-gray-100 text-gray-700 py-3 rounded-lg hover:bg-gray-200 transition-colors font-medium">
            <i class="fas fa-times mr-2"></i>
            Очистить фильтры
          </button>
        </div>
      </aside>

      <!-- Main Content -->
      <div class="flex-1 space-y-6">
        <!-- Top Bar -->
        <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
          <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <div class="flex items-center space-x-4">
              <h2 class="text-xl font-semibold text-gray-900">Найдено товаров: <span class="text-primary-600">{{ products|length }}</span></h2>
            </div>
            
            <div class="flex items-center space-x-4">
              <!-- View Toggle -->
              <div class="flex bg-gray-100 rounded-lg p-1">
                <button id="grid-view" class="px-3 py-2 rounded-md text-gray-600 hover:text-primary-600 transition-colors">
                  <i class="fas fa-th-large"></i>
                </button>
                <button id="list-view" class="px-3 py-2 rounded-md text-gray-600 hover:text-primary-600 transition-colors">
                  <i class="fas fa-list"></i>
                </button>
              </div>
              
              <!-- Sort Dropdown -->
              <select class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 bg-white">
                <option>Сортировать по</option>
                <option>Цена: по возрастанию</option>
                <option>Цена: по убыванию</option>
                <option>По популярности</option>
                <option>По новизне</option>
                <option>По рейтингу</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Products Grid -->
        <div id="products-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
          {% for product in products %}
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-lg transition-all duration-300 group">
              <!-- Product Image -->
              <div class="relative overflow-hidden">
                {% if product.image %}
                  <img src="{{ product.image.url }}" 
                       alt="{{ product.name }}" 
                       class="w-full h-64 object-cover group-hover:scale-105 transition-transform duration-300">
                {% else %}
                  <div class="w-full h-64 bg-gray-200 flex items-center justify-center">
                    <i class="fas fa-image text-gray-400 text-4xl"></i>
                  </div>
                {% endif %}
                
                <!-- Product Badges -->
                <div class="absolute top-4 left-4 space-y-2">
                  {% if product.is_new %}
                    <span class="bg-green-500 text-white px-2 py-1 rounded-full text-xs font-medium">NEW</span>
                  {% endif %}
                  {% if product.is_sale %}
                    <span class="bg-red-500 text-white px-2 py-1 rounded-full text-xs font-medium">SALE</span>
                  {% endif %}
                </div>

                <!-- Quick Actions -->
                <div class="absolute top-4 right-4 space-y-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                  <button class="w-10 h-10 bg-white rounded-full shadow-lg flex items-center justify-center hover:bg-primary-50 transition-colors">
                    <i class="fas fa-heart text-gray-600 hover:text-red-500"></i>
                  </button>
                  <button class="w-10 h-10 bg-white rounded-full shadow-lg flex items-center justify-center hover:bg-primary-50 transition-colors">
                    <i class="fas fa-eye text-gray-600 hover:text-primary-600"></i>
                  </button>
                </div>

                <!-- Quick Add to Cart -->
                <div class="absolute bottom-4 left-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                  <form method="post" action="{% url 'add_to_cart' product.pk %}">
                    {% csrf_token %}
                    <button type="submit" class="w-full bg-primary-600 text-white py-2 rounded-lg hover:bg-primary-700 transition-colors font-medium">
                      <i class="fas fa-shopping-cart mr-2"></i>
                      В корзину
                    </button>
                  </form>
                </div>
              </div>

              <!-- Product Info -->
              <div class="p-6">
                <div class="flex items-start justify-between mb-2">
                  <div class="flex-1">
                    {% if product.brand %}
                      <p class="text-sm text-gray-500 mb-1">{{ product.brand }}</p>
                    {% endif %}
                    <h3 class="text-lg font-semibold text-gray-900 mb-2 line-clamp-2 group-hover:text-primary-600 transition-colors">
                      <a href="{% url 'product_detail' product.pk %}">{{ product.name }}</a>
                    </h3>
                  </div>
                </div>

                <!-- Rating -->
                <div class="flex items-center mb-3">
                  <div class="flex text-yellow-400 mr-2">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star-half-alt"></i>
                  </div>
                  <span class="text-sm text-gray-600">(4.5) • 24 отзыва</span>
                </div>

                <!-- Price -->
                <div class="flex items-center justify-between">
                  <div class="flex items-center space-x-2">
                    <span class="text-2xl font-bold text-primary-600">{{ product.price }} ₽</span>
                    {% if product.old_price %}
                      <span class="text-lg text-gray-400 line-through">{{ product.old_price }} ₽</span>
                    {% endif %}
                  </div>
                  {% if product.discount_percent %}
                    <span class="bg-red-100 text-red-600 px-2 py-1 rounded-full text-sm font-medium">
                      -{{ product.discount_percent }}%
                    </span>
                  {% endif %}
                </div>

                <!-- Sizes -->
                {% if product.available_sizes %}
                  <div class="mt-4">
                    <p class="text-sm text-gray-600 mb-2">Размеры:</p>
                    <div class="flex flex-wrap gap-1">
                      {% for size in product.available_sizes %}
                        <span class="px-2 py-1 border border-gray-300 rounded text-xs">{{ size }}</span>
                      {% endfor %}
                    </div>
                  </div>
                {% endif %}
              </div>
            </div>
          {% empty %}
            <!-- Empty State -->
            <div class="col-span-full text-center py-16">
              <div class="max-w-md mx-auto">
                <div class="bg-gray-100 rounded-full w-24 h-24 flex items-center justify-center mx-auto mb-6">
                  <i class="fas fa-search text-gray-400 text-3xl"></i>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-4">Товары не найдены</h3>
                <p class="text-gray-600 mb-6">
                  Попробуйте изменить параметры поиска или очистить фильтры
                </p>
                <button class="bg-primary-600 text-white px-6 py-3 rounded-lg hover:bg-primary-700 transition-colors">
                  Очистить фильтры
                </button>
              </div>
            </div>
          {% endfor %}
        </div>

        <!-- Pagination -->
        {% if products.has_other_pages %}
          <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
            <nav class="flex justify-center">
              <div class="flex items-center space-x-2">
                {% if products.has_previous %}
                  <a href="?page={{ products.previous_page_number }}" 
                     class="px-4 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors">
                    <i class="fas fa-chevron-left mr-1"></i>
                    Назад
                  </a>
                {% endif %}
                
                <div class="flex items-center space-x-1">
                  {% for page_num in products.paginator.page_range %}
                    {% if page_num == products.number %}
                      <span class="px-4 py-2 bg-primary-600 text-white rounded-lg">{{ page_num }}</span>
                    {% else %}
                      <a href="?page={{ page_num }}" 
                         class="px-4 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-primary-100 hover:text-primary-600 transition-colors">
                        {{ page_num }}
                      </a>
                    {% endif %}
                  {% endfor %}
                </div>
                
                {% if products.has_next %}
                  <a href="?page={{ products.next_page_number }}" 
                     class="px-4 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors">
                    Вперед
                    <i class="fas fa-chevron-right ml-1"></i>
                  </a>
                {% endif %}
              </div>
            </nav>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>

<script>
// Mobile filter toggle
document.getElementById('filter-toggle').addEventListener('click', function() {
  const panel = document.getElementById('filter-panel');
  panel.classList.toggle('hidden');
});

// View toggle
document.getElementById('grid-view').addEventListener('click', function() {
  const container = document.getElementById('products-container');
  container.className = 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6';
  this.classList.add('bg-primary-100', 'text-primary-600');
  document.getElementById('list-view').classList.remove('bg-primary-100', 'text-primary-600');
});

document.getElementById('list-view').addEventListener('click', function() {
  const container = document.getElementById('products-container');
  container.className = 'space-y-6';
  this.classList.add('bg-primary-100', 'text-primary-600');
  document.getElementById('grid-view').classList.remove('bg-primary-100', 'text-primary-600');
});

// Size selection
document.querySelectorAll('.grid button').forEach(button => {
  button.addEventListener('click', function() {
    // Remove active class from all size buttons
    document.querySelectorAll('.grid button').forEach(btn => {
      btn.classList.remove('border-primary-500', 'bg-primary-50', 'text-primary-600');
      btn.classList.add('border-gray-300');
    });
    
    // Add active class to clicked button
    this.classList.remove('border-gray-300');
    this.classList.add('border-primary-500', 'bg-primary-50', 'text-primary-600');
  });
});

// Add to cart with animation
document.querySelectorAll('form[action*="add_to_cart"]').forEach(form => {
  form.addEventListener('submit', function(e) {
    const button = this.querySelector('button[type="submit"]');
    const originalText = button.innerHTML;
    
    button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Добавляем...';
    button.disabled = true;
    
    // Re-enable after 2 seconds (adjust based on your backend response)
    setTimeout(() => {
      button.innerHTML = '<i class="fas fa-check mr-2"></i>Добавлено!';
      setTimeout(() => {
        button.innerHTML = originalText;
        button.disabled = false;
      }, 1000);
    }, 1000);
  });
});
</script>
{% endblock %}